(async()=>{let t,e;const o=await async function(){try{const t=await fetch("/propose.json");if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.json()}catch(t){console.error("Error fetching data:",t)}}();let a;if(o.variable&&(a=o.variable),o.preloader){const a=await fetch(o.preloader);if(!a.ok)throw new Error(`Failed to fetch /preloader.html: ${a.statusText}`);t=await a.text(),e=document.createElement("div"),e.innerHTML=t,Object.assign(e.style,{height:"100vh",position:"fixed",left:"0",right:"0",top:"0",zIndex:"999"}),document.body.appendChild(e)}if(a){const t=document.body,e=new Range;for(let o in a){let n=t.querySelectorAll(o);n.length>0&&fetch(a[o]).then((async t=>{if(!t.ok)throw new Error(`Failed to fetch ${a[o]}`);const c=await t.text();n.forEach((t=>{const o=u(c,t),a=e.createContextualFragment(o);t.replaceWith(a)}))})).catch((t=>console.error("Error:",t)))}}if(o.constant&&await async function(t){try{for(const[e,o]of Object.entries(t)){const t=await fetch(o);if(!t.ok)throw new Error(`Failed to fetch ${o}`);const n=await t.text(),c=new Range,r=await c.createContextualFragment(n);if(a)for(let t in a){let e=await r.querySelectorAll(t);if(e.length>0){const o=await fetch(a[t]);if(!o.ok)throw new Error(`Failed to fetch ${a[t]}`);const n=await o.text();for(let t of e){const e=await u(n,t),o=await c.createContextualFragment(e);await t.replaceWith(o)}}}await document.querySelector(e).appendChild(r)}}catch(t){console.error("Error loading content:",t)}}(o.constant),o.common&&await r(o.common),o.css.constant&&await async function(t){for(const e of t)try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch CSS: ${t.status}`);const o=await t.text(),a=document.createElement("style");a.setAttribute("data-css",e),a.textContent=o,await document.head.appendChild(a)}catch(t){console.error("Error fetching CSS:",t)}}(o.css.constant),o.css.common){let t=window.location.pathname;t=t.substring(0,t.lastIndexOf("/")),""===t&&localStorage.removeItem("commonCSS"),await s(o.css.common)}if(o.css.specific&&await l(o.css.specific),o.script.every&&await m(o.script.every),o.script.constant&&await async function(t){try{for(const e of t){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch script: ${t.statusText}`);const o=await t.text(),a=new Function(o);await a()}}catch(t){console.error("Error executing scripts:",t)}}(o.script.constant),o.script.common&&await w(o.script.common),o.script.specific&&await f(o.script.specific),t){!async function(){await new Promise((t=>setTimeout(t,100))),e.remove()}()}window.scrollTo({top:0});const n=new AbortController;window.addEventListener("popstate",(async()=>{if(n.abort(),o.unique&&await i(o.unique),o.common&&await r(o.common),o.css.common){let t=window.location.pathname;t=t.substring(0,t.lastIndexOf("/")),""===t&&localStorage.removeItem("commonCSS"),await s(o.css.common)}o.script.every&&await m(o.script.every),o.css.specific&&await l(o.css.specific),o.script.common&&await w(o.script.common),o.script.specific&&await f(o.script.specific)}));document.querySelectorAll("a").forEach((t=>{t.hasAttribute("target")||t.addEventListener("click",(async e=>{n.abort(),e.preventDefault();const a=t.getAttribute("href");if(history.pushState({},"",a),o.unique&&await i(o.unique),o.common&&await r(o.common),o.css.common){let t=window.location.pathname;t=t.substring(0,t.lastIndexOf("/")),""===t&&localStorage.removeItem("commonCSS"),await s(o.css.common)}o.script.every&&await m(o.script.every),o.css.specific&&await l(o.css.specific),o.script.common&&await w(o.script.common),o.script.specific&&await f(o.script.specific)}))}));const c=t=>{"A"===t.tagName&&t.addEventListener("click",(async e=>{if(!e.target.hasAttribute("target")){n.abort(),e.preventDefault();const a=t.getAttribute("href");if(history.pushState({},"",a),o.unique&&await i(o.unique),o.common&&await r(o.common),o.css.common){let t=window.location.pathname;t=t.substring(0,t.lastIndexOf("/")),""===t&&localStorage.removeItem("commonCSS"),await s(o.css.common)}o.css.specific&&await l(o.css.specific),o.script.every&&await m(o.script.every),o.script.common&&await w(o.script.common),o.script.specific&&await f(o.script.specific)}}))};async function r(e){let o=window.location.pathname,n=o.substring(0,o.lastIndexOf("/"))||"/";if(n!==localStorage.getItem("previousDirectory")&&(localStorage.setItem("previousDirectory",n),e[n])){let o=e[n],c=[];for(let e in o){let a=o[e];t&&(document.querySelector(a).innerHTML=t),c.push(fetch(e).then((t=>t.text().then((t=>({to:a,text:t}))))))}try{for(const{to:t,text:e}of await Promise.all(c)){const o=new Range,n=await o.createContextualFragment(e);if(a)for(let t in a){let e=await n.querySelectorAll(t);if(e.length>0){const n=await fetch(a[t]);if(!n.ok)throw new Error(`Failed to fetch ${a[t]}`);const c=await n.text();for(let t of e){const e=await u(c,t),a=await o.createContextualFragment(e);await t.replaceWith(a)}}}setTimeout((()=>{document.querySelector(t).replaceWith(n)}),1e3)}}catch(t){console.error("Error fetching content:",t)}}}async function i(e){for(const o of e)t&&(document.querySelector(o).innerHTML=t);const o=window.location.pathname;try{const t=await fetch(o);if(!t.ok){history.pushState({},"","/404.html");const t=await fetch("/404.html"),o=await t.text(),a=new Range,n=await a.createContextualFragment(o);for(const t of e){const e=n.querySelector(t);e?await document.querySelector(t).replaceWith(e):console.warn(`Selector ${t} not found in fetched content.`)}return}const n=await t.text(),c=new Range,r=await c.createContextualFragment(n);if(a)for(let t in a){let e=r.querySelectorAll(t);if(e.length>0){const o=await fetch(a[t]);if(!o.ok)throw new Error(`Failed to fetch ${a[t]}`);const n=await o.text();for(let t of e){const e=await u(n,t),o=await c.createContextualFragment(e);await t.replaceWith(o)}}}for(const t of e){const e=r.querySelector(t);e?await document.querySelector(t).replaceWith(e):console.warn(`Selector ${t} not found in fetched content.`)}}catch(t){console.error("Error fetching or processing content:",t)}}async function s(t){let e=window.location.pathname;e=e.substring(0,e.lastIndexOf("/"))||"/";const o=localStorage.getItem("commonCSS");try{for(let a of Object.keys(t))if(o!==a&&e===a){localStorage.setItem("commonCSS",e);for(const e of t[a]){if(!document.querySelector(`[data-css='${e}']`))try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch CSS: ${t.status}`);const o=await t.text(),a=document.createElement("style");a.setAttribute("data-css",e),a.textContent=o,await document.head.appendChild(a)}catch(t){console.error("Error fetching CSS:",t)}}}else if(e!==a)for(const e of t[a]){let t=document.querySelector(`[data-css='${e}']`);t&&(t.remove(),localStorage.removeItem("commonCSS"))}}catch(t){console.error("Error processing CSS:",t)}}async function l(t){document.head.querySelectorAll("[data-specificss]").forEach((t=>t.remove()));const e=window.location.pathname;if(t[e])for(const o of t[e])try{const t=await fetch(o);if(!t.ok)throw new Error(`Failed to fetch ${o}: ${t.statusText}`);const e=await t.text(),a=document.createElement("style");a.setAttribute("data-specificss",o),a.textContent=e,await document.head.appendChild(a)}catch(t){console.error(`Error loading CSS from ${o}:`,t)}}async function w(t){const e=window.location.pathname;let o=e.substring(0,e.lastIndexOf("/"));""===o&&(o="/");for(let e in t)o.endsWith(e)&&await m(t[e])}async function f(t){const e=window.location.pathname;for(let o in t)e===o&&await m(t[o])}async function m(t){for(const e of t){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch script: ${t.statusText}`);const o=await t.text(),a=new Function(o),n=new Set,c=new Set,r=window.setTimeout,i=window.setInterval,s=window.clearTimeout,l=window.clearInterval;window.setTimeout=function(t,e,...o){const a=r(t,e,...o);return n.add(a),a},window.setInterval=function(t,e,...o){const a=i(t,e,...o);return c.add(a),a},window.clearTimeout=function(t){n.delete(t),s(t)},window.clearInterval=function(t){c.delete(t),l(t)};const w=Element.prototype.addEventListener,f=new Map;Element.prototype.addEventListener=function(t,e,o){f.has(this)||f.set(this,[]),f.get(this).push({type:t,listener:e,options:o}),w.call(this,t,e,o)},getAllEventListeners=function(){const t=[];return f.forEach(((e,o)=>{e.forEach((e=>{t.push({...e,element:o})}))})),t},await a();const m=await getAllEventListeners(),u=async function(){n.forEach((t=>{window.clearTimeout(t)})),c.forEach((t=>{window.clearInterval(t)})),n.clear(),c.clear()};window.addEventListener("popstate",(async()=>{m.forEach((async(t,e)=>{let o=t.element;await o.removeEventListener(t.type,t.listener,t.options),delete m[e]})),await u()})),document.querySelectorAll("a").forEach((async t=>{t.hasAttribute("target")||t.addEventListener("click",(async()=>{m.forEach((async(t,e)=>{let o=t.element;await o.removeEventListener(t.type,t.listener,t.options),delete m[e]})),await u()}))}))}}function u(t,e){return t.replace(/\${(.*?)}/g,((t,o)=>e.getAttribute(o)||t))}new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{1===t.nodeType&&(c(t),t.querySelectorAll("a").forEach((t=>c(t))))}))}))})).observe(document.body,{childList:!0,subtree:!0})})();