(async()=>{let t,e,a=await v();if(a.preloader){let r=await fetch(a.preloader);if(!r.ok)throw Error(`Failed to fetch /preloader.html: ${r.statusText}`);t=await r.text(),(e=document.createElement("div")).innerHTML=t,Object.assign(e.style,{height:"100vh",position:"fixed",left:"0",right:"0",top:"0",zIndex:"999"}),document.body.appendChild(e)}if(a.constant&&await f(a.constant),a.common&&(localStorage.removeItem("previousDirectory"),await m(a.common)),a.css.constant&&await u(a.css.constant),a.css.common){let c=window.location.pathname;c=c.substring(0,c.lastIndexOf("/")),localStorage.removeItem("commonCSS"),await h(a.css.common)}if(a.css.specific&&await d(a.css.specific),a.script.constant&&await w(a.script.constant),a.script.specific&&await E(a.script.specific),a.script.common&&await y(a.script.common),t){async function n(){await new Promise(t=>setTimeout(t,100)),e.remove()}n()}window.scrollTo({top:0});let o=new AbortController;window.addEventListener("popstate",async()=>{if(o.abort(),a.unique&&await p(a.unique),a.common&&await m(a.common),a.css.common){let t=window.location.pathname;""===(t=t.substring(0,t.lastIndexOf("/")))&&localStorage.removeItem("commonCSS"),await h(a.css.common)}a.css.specific&&await d(a.css.specific),a.script.specific&&await E(a.script.specific),a.script.common&&await y(a.script.common)});let i=document.querySelectorAll("a");i.forEach(t=>{t.hasAttribute("target")||t.addEventListener("click",async e=>{o.abort(),e.preventDefault();let r=t.getAttribute("href");history.pushState({},"",r),a.unique&&await p(a.unique),a.css&&(a.common&&await m(a.common),a.css.common&&await h(a.css.common)),a.css.specific&&await d(a.css.specific),a.script.specific&&await E(a.script.specific),a.script.common&&await y(a.script.common)})});let s=t=>{"A"===t.tagName&&t.addEventListener("click",async e=>{if(!e.target.hasAttribute("target")){o.abort(),e.preventDefault();let r=t.getAttribute("href");history.pushState({},"",r),a.unique&&await p(a.unique),a.css&&(a.common&&await m(a.common),a.css.common&&await h(a.css.common)),a.css.specific&&await d(a.css.specific),a.script.specific&&await E(a.script.specific),a.script.common&&await y(a.script.common)}})},l=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{1===t.nodeType&&(s(t),t.querySelectorAll("a").forEach(t=>s(t)))})})});async function f(t){try{let e=Object.entries(t).map(async([t,e])=>{let a=await fetch(e);if(!a.ok)throw Error(`Failed to fetch ${e}`);let r=await a.text(),c=new Range,n=c.createContextualFragment(r);document.querySelector(t).appendChild(n)});await Promise.all(e)}catch(a){console.error("Error loading content:",a)}}async function m(e){let a=window.location.pathname,r=a.substring(0,a.lastIndexOf("/"))||"/";if(r!==localStorage.getItem("previousDirectory")&&(localStorage.setItem("previousDirectory",r),e[r])){let c=e[r],n=[];for(let o in c){let i=c[o];t&&(document.querySelector(i).innerHTML=t),n.push(fetch(o).then(t=>t.text().then(t=>({to:i,text:t}))))}try{(await Promise.all(n)).forEach(({to:t,text:e})=>{let a=new Range,r=a.createContextualFragment(e);document.querySelector(t).replaceWith(r)})}catch(s){console.error("Error fetching content:",s)}}}async function p(e){e.map(e=>{t&&(document.querySelector(e).innerHTML=t)});let a=window.location.pathname;try{let r=await fetch(a);if(!r.ok){history.pushState({},"","/404.html");let c=await fetch("/404.html"),n=await c.text(),o=new Range,i=o.createContextualFragment(n),s=e.map(t=>{let e=i.querySelector(t);e?document.querySelector(t).replaceWith(e):console.warn(`Selector ${t} not found in fetched content.`)});await Promise.all(s);return}let l=await r.text(),f=new Range,m=f.createContextualFragment(l),p=e.map(t=>{let e=m.querySelector(t);e?document.querySelector(t).replaceWith(e):console.warn(`Selector ${t} not found in fetched content.`)});await Promise.all(p)}catch(u){console.error("Error fetching or processing content:",u)}}async function u(t){let e=t.map(async t=>{try{let e=await fetch(t);if(!e.ok)throw Error(`Failed to fetch CSS: ${e.status}`);let a=await e.text(),r=document.createElement("style");r.setAttribute("data-css",t),r.textContent=a,document.head.appendChild(r)}catch(c){console.error("Error fetching CSS:",c)}});await Promise.all(e)}async function h(t){let e=window.location.pathname;e=e.substring(0,e.lastIndexOf("/"))||"/";let a=localStorage.getItem("commonCSS");try{for(let r of Object.keys(t))if(a!==r&&e===r){localStorage.setItem("commonCSS",e);let c=t[r].map(async t=>{if(!document.querySelector(`[data-css='${t}']`))try{let e=await fetch(t);if(!e.ok)throw Error(`Failed to fetch CSS: ${e.status}`);let a=await e.text(),r=document.createElement("style");r.setAttribute("data-css",t),r.textContent=a,document.head.appendChild(r)}catch(c){console.error("Error fetching CSS:",c)}});await Promise.all(c)}else e!==r&&t[r].forEach(t=>{let e=document.querySelector(`[data-css='${t}']`);e&&(e.remove(),localStorage.removeItem("commonCSS"))})}catch(n){console.error("Error processing CSS:",n)}}async function d(t){document.head.querySelectorAll("[data-specificss]").forEach(t=>t.remove());let e=window.location.pathname;if(t[e]){let a=t[e].map(async t=>{try{let e=await fetch(t);if(!e.ok)throw Error(`Failed to fetch ${t}: ${e.statusText}`);let a=await e.text(),r=document.createElement("style");r.setAttribute("data-specificss",t),r.textContent=a,document.head.appendChild(r)}catch(c){console.error(`Error loading CSS from ${t}:`,c)}});await Promise.all(a)}}async function w(t){try{let e=t.map(async t=>{let e=await fetch(t);if(!e.ok)throw Error(`Failed to fetch script: ${e.statusText}`);let a=await e.text(),r=Function(a);r()});await Promise.all(e)}catch(a){console.error("Error executing scripts:",a)}}async function y(t){let e=window.location.pathname,a=e.substring(0,e.lastIndexOf("/")||"/");for(let r in t)if(a.endsWith(r))for(let c of t[r])fetch(c).then(async t=>{if(!t.ok)throw Error(`Failed to fetch script: ${t.statusText}`);let e=await t.text(),a=Function(e),r=new Set,c=new Set,n=window.setTimeout,o=window.setInterval,i=window.clearTimeout,s=window.clearInterval;window.setTimeout=function(t,e,...a){let c=n(t,e,...a);return r.add(c),c},window.setInterval=function(t,e,...a){let r=o(t,e,...a);return c.add(r),r},window.clearTimeout=function(t){r.delete(t),i(t)},window.clearInterval=function(t){c.delete(t),s(t)};let l=Element.prototype.addEventListener,f=new Map;Element.prototype.addEventListener=function(t,e,a){f.has(this)||f.set(this,[]),f.get(this).push({type:t,listener:e,options:a}),l.call(this,t,e,a)},getAllEventListeners=function(){let t=[];return f.forEach((e,a)=>{e.forEach(e=>{t.push({...e,element:a})})}),t},a();let m=getAllEventListeners(),p=function(){r.forEach(t=>{window.clearTimeout(t)}),c.forEach(t=>{window.clearInterval(t)}),r.clear(),c.clear()};window.addEventListener("popstate",async()=>{p(),m.forEach(t=>{t.element.removeEventListener(t.type,t.listener,t.options)})}),document.querySelectorAll("a").forEach(t=>{t.hasAttribute("target")||t.addEventListener("click",()=>{p(),m.forEach(t=>{t.element.removeEventListener(t.type,t.listener,t.options)})})})}).catch(t=>{console.error(t)})}async function E(t){let e=window.location.pathname;for(let a in t)if(e===a)for(let r of t[a])fetch(r).then(async t=>{if(!t.ok)throw Error(`Failed to fetch script: ${t.statusText}`);let e=await t.text(),a=Function(e),r=new Set,c=new Set,n=window.setTimeout,o=window.setInterval,i=window.clearTimeout,s=window.clearInterval;window.setTimeout=function(t,e,...a){let c=n(t,e,...a);return r.add(c),c},window.setInterval=function(t,e,...a){let r=o(t,e,...a);return c.add(r),r},window.clearTimeout=function(t){r.delete(t),i(t)},window.clearInterval=function(t){c.delete(t),s(t)};let l=Element.prototype.addEventListener,f=new Map;Element.prototype.addEventListener=function(t,e,a){f.has(this)||f.set(this,[]),f.get(this).push({type:t,listener:e,options:a}),l.call(this,t,e,a)},getAllEventListeners=function(){let t=[];return f.forEach((e,a)=>{e.forEach(e=>{t.push({...e,element:a})})}),t},a();let m=getAllEventListeners(),p=function(){r.forEach(t=>{window.clearTimeout(t)}),c.forEach(t=>{window.clearInterval(t)}),r.clear(),c.clear()};window.addEventListener("popstate",async()=>{p(),m.forEach(t=>{t.element.removeEventListener(t.type,t.listener,t.options)})}),document.querySelectorAll("a").forEach(t=>{t.hasAttribute("target")||t.addEventListener("click",()=>{p(),m.forEach(t=>{t.element.removeEventListener(t.type,t.listener,t.options)})})})}).catch(t=>{console.error(t)})}async function v(){try{let t=await fetch("/propose.json");if(!t.ok)throw Error(`HTTP error! Status: ${t.status}`);let e=await t.json();return e}catch(a){console.error("Error fetching data:",a)}}l.observe(document.body,{childList:!0,subtree:!0})})();